effective: |
  ignore:
  - node_modules
  - /apps/docs
  - /apps/server
  - /apps/checker
  - /apps/dashboard
  - /apps/screenshot-service
  - /apps/workflows
  - /packages/integrations
  builders:
    install:
      fromImage:
        path: oven/bun
        digest: sha256:78f46b81b82d767ee8d729411f6f95089a403c21f17c20a5789df00263d7c5b5
      workdir: /app/
      run:
      - bun install --production --ignore-scripts --frozen-lockfile --verbose
      cache:
      - target: /root/.bun/install/cache
      bind:
      - target: package.json
        source: package.json
      - target: apps/web/package.json
        source: apps/web/package.json
      - target: packages/analytics/package.json
        source: packages/analytics/package.json
      - target: packages/api/package.json
        source: packages/api/package.json
      - target: packages/assertions/package.json
        source: packages/assertions/package.json
      - target: packages/db/package.json
        source: packages/db/package.json
      - target: packages/emails/package.json
        source: packages/emails/package.json
      - target: packages/error/package.json
        source: packages/error/package.json
      - target: packages/header-analysis/package.json
        source: packages/header-analysis/package.json
      - target: packages/notification-discord/package.json
        source: packages/notification-discord/package.json
      - target: packages/notification-emails/package.json
        source: packages/notification-emails/package.json
      - target: packages/notification-ntfy/package.json
        source: packages/notification-ntfy/package.json
      - target: packages/notification-opsgenie/package.json
        source: packages/notification-opsgenie/package.json
      - target: packages/notification-pagerduty/package.json
        source: packages/notification-pagerduty/package.json
      - target: packages/notification-slack/package.json
        source: packages/notification-slack/package.json
      - target: packages/notification-webhook/package.json
        source: packages/notification-webhook/package.json
      - target: packages/react/package.json
        source: packages/react/package.json
      - target: packages/tinybird/package.json
        source: packages/tinybird/package.json
      - target: packages/tracker/package.json
        source: packages/tracker/package.json
      - target: packages/tsconfig/package.json
        source: packages/tsconfig/package.json
      - target: packages/ui/package.json
        source: packages/ui/package.json
      - target: packages/upstash/package.json
        source: packages/upstash/package.json
      - target: packages/utils/package.json
        source: packages/utils/package.json
    build:
      fromImage:
        path: oven/bun
        digest: sha256:78f46b81b82d767ee8d729411f6f95089a403c21f17c20a5789df00263d7c5b5
      workdir: /app/apps/web
      env:
        NODE_ENV: production
      copy:
      - paths:
        - .
        target: /app/
      - fromBuilder: install
        paths:
        - /app/node_modules
        target: /app/node_modules
      run:
      - bun build --compile --sourcemap src/index.ts --outfile=app
  fromImage:
    path: debian
    digest: sha256:c2c58af6e3ceeb3ed40adba85d24cfa62b7432091597ada9b76b56a51b62f4c6
  copy:
  - fromBuilder: build
    paths:
    - /app/apps/web/app
    target: /bin/
    chmod: '555'
  entrypoint:
  - /bin/app
  expose:
  - port: 3000
images:
  docker.io:
    oven:
      bun:
        latest:
          digest: sha256:78f46b81b82d767ee8d729411f6f95089a403c21f17c20a5789df00263d7c5b5
    library:
      debian:
        bullseye-slim:
          digest: sha256:c2c58af6e3ceeb3ed40adba85d24cfa62b7432091597ada9b76b56a51b62f4c6
resources:
  dofigen.yml:
    hash: 1cdae1c8bc145d5b6d67a407efdb0f3b957349a94b4c79705d36b18e4f2ba00c
    content: |-
      ignore:
        - node_modules
        - /apps/docs
        - /apps/server
        - /apps/checker
        - /apps/dashboard
        - /apps/screenshot-service
        - /apps/workflows
        - /packages/integrations
      builders:
        install:
          fromImage: oven/bun
          workdir: /app/
          # Copy project
          bind:
            - package.json
            - apps/web/package.json
            - packages/analytics/package.json
            - packages/api/package.json
            - packages/assertions/package.json
            - packages/db/package.json
            - packages/emails/package.json
            - packages/error/package.json
            - packages/header-analysis/package.json
            - packages/notification-discord/package.json
            - packages/notification-emails/package.json
            - packages/notification-ntfy/package.json
            - packages/notification-opsgenie/package.json
            - packages/notification-pagerduty/package.json
            - packages/notification-slack/package.json
            - packages/notification-webhook/package.json
            - packages/react/package.json
            - packages/tinybird/package.json
            - packages/tracker/package.json
            - packages/tsconfig/package.json
            - packages/ui/package.json
            - packages/upstash/package.json
            - packages/utils/package.json
          # Install dependencies
          run: bun install --production --ignore-scripts --frozen-lockfile --verbose
          cache:
            - /root/.bun/install/cache
        build:
          fromImage: oven/bun
          workdir: /app/apps/web
          copy:
            - . /app/
            - fromBuilder: install
              source: /app/node_modules
              target: /app/node_modules
            #  Should set env to production here
          # Compile the TypeScript application
          env:
            NODE_ENV: production
          run: bun build --compile --sourcemap src/index.ts --outfile=app
      fromImage: debian:bullseye-slim
      copy:
        - fromBuilder: build
          source: /app/apps/web/app
          target: /bin/
          chmod: "555"
      expose: 3000
      entrypoint: /bin/app
